<!DOCTYPE html>
<html>
  <head>
    <title>Map with Glide Table Pins</title>
    <style>
      #map {
        height: 90vh;
        width: 100%;
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
  </head>
  <body>
    <h2>Dynamic Map from Glide Table</h2>
    <div id="map"></div>

    <script>
      async function loadPinsFromGlide(map) {
        try {
          const response = await fetch("https://gapi.glideapp.io/api/function_call", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "x-glide-api-key": "4c8dde9f-896c-41fe-8fc2-7cf292e0cf61"
            },
            body: JSON.stringify({
              appID: "AaC2jhlDbFkyHaGUQr24",
              function: "table.getAllRows",
              args: {
                tableID: "native-table-fEIWIJDP168Lk1NKrizd"
              }
            })
          });

          const pins = await response.json();

          if (!Array.isArray(pins)) {
            console.error("Unexpected response from Glide API:", pins);
            return;
          }

          pins.forEach(pin => {
            const lat = parseFloat(pin.Lat);
            const lng = parseFloat(pin.Lng);
            const address = pin.Address || pin.Name || "Unnamed location";

            if (!isNaN(lat) && !isNaN(lng)) {
              addMarker({ lat, lng }, address, map);
            }
          });
        } catch (error) {
          console.error("Error loading pins from Glide:", error);
        }
      }

      function addMarker(position, title, map) {
        new google.maps.Marker({
          position,
          map,
          title
        });
      }

      function initMap() {
        const center = { lat: 45.4215, lng: -75.6972 }; // Default center: Ottawa
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center
        });

        loadPinsFromGlide(map);
      }

      window.onload = initMap;
    </script>
  </body>
</html>
